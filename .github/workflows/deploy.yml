# å·¥ä½œæµå
name: Deploy Hexo to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šå½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘
on:
  push:
    branches:
      - main # æˆ–è€…ä½ çš„ä¸»åˆ†æ”¯åï¼Œæ¯”å¦‚ master

# ä»»åŠ¡
jobs:
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ£€å‡ºä½ çš„æºç ä»“åº“
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3
        # å¦‚æœä½ çš„ä¸»é¢˜æ˜¯ Git Submoduleï¼Œéœ€è¦åŠ ä¸Š
        # with:
        #   submodules: true 

      # ç¬¬äºŒæ­¥ï¼šè®¾ç½® Node.js ç¯å¢ƒ
      - name: Set up Node.js ğŸŸ©
        uses: actions/setup-node@v3
        with:
          node-version: '20' # å»ºè®®ä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬
          cache: 'npm' # ç¼“å­˜ npm ä¾èµ–

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–
      - name: Install Dependencies ğŸ“¦
        run: npm install

      # ç¬¬å››æ­¥ï¼šç”Ÿæˆé™æ€æ–‡ä»¶
      - name: Generate Static Files ğŸ“
        run: npx hexo generate

      # ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages ğŸš€
        # ä½¿ç”¨ä¸€ä¸ªéå¸¸æµè¡Œçš„ GitHub Action æ’ä»¶
        uses: peaceiris/actions-gh-pages@v3
        with:
          # GITHUB_TOKEN æ˜¯ç”± GitHub Actions è‡ªåŠ¨åˆ›å»ºçš„ï¼Œä½ æ— éœ€è®¾ç½®
          github_token: ${{ secrets.GITHUB_TOKEN }}

          # ã€é‡è¦ã€‘æŒ‡å®šè¦æ¨é€åˆ°çš„ã€éƒ¨ç½²ä»“åº“ã€‘
          # æ ¼å¼ï¼š<ä½ çš„ç”¨æˆ·å>/<ä½ çš„ç”¨æˆ·å>.github.io
          external_repository: demouo/my-site

          # ã€é‡è¦ã€‘æŒ‡å®šã€éƒ¨ç½²ä»“åº“ã€‘çš„ç›®æ ‡åˆ†æ”¯
          # æ³¨æ„ï¼šyour-username.github.io ä»“åº“é€šå¸¸ä½¿ç”¨ main æˆ– master ä½œä¸º Pages æº
          publish_branch: main 

          # Hexo ç”Ÿæˆçš„é™æ€æ–‡ä»¶é»˜è®¤åœ¨ public ç›®å½•
          publish_dir: ./public

          # ï¼ˆå¯é€‰ï¼‰è‡ªå®šä¹‰ CNAME
          # cname: your-domain.com

          # ï¼ˆå¯é€‰ï¼‰éƒ¨ç½²æäº¤çš„ä½œè€…ä¿¡æ¯
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'

          # ï¼ˆå¯é€‰ï¼‰å…è®¸æ¨é€ç©ºæäº¤ï¼Œç¡®ä¿åˆ†æ”¯å­˜åœ¨
          allow_empty_commit: true
