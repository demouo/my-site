# å·¥ä½œæµå
name: Deploy Hexo to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šå½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘
on:
  push:
    branches:
      - main # æˆ–è€…ä½ çš„ä¸»åˆ†æ”¯åï¼Œæ¯”å¦‚ master

# ä»»åŠ¡
jobs:
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ£€å‡ºä½ çš„æºç ä»“åº“
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3
        # å¦‚æœä½ çš„ä¸»é¢˜æ˜¯ Git Submoduleï¼Œéœ€è¦åŠ ä¸Š
        # with:
        #   submodules: true 

      # ç¬¬äºŒæ­¥ï¼šè®¾ç½® Node.js ç¯å¢ƒ
      - name: Set up Node.js ğŸŸ©
        uses: actions/setup-node@v3
        with:
          node-version: '20' # å»ºè®®ä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬
          cache: 'npm' # ç¼“å­˜ npm ä¾èµ–

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–
      - name: Install Dependencies ğŸ“¦
        run: npm install

      # ç¬¬å››æ­¥ï¼šç”Ÿæˆé™æ€æ–‡ä»¶
      - name: Generate Static Files ğŸ“
        run: npx hexo generate

      # ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          # ä½¿ç”¨ GITHUB_TOKENï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯æ¨é€åˆ° *å½“å‰* ä»“åº“
          github_token: ${{ secrets.GITHUB_TOKEN }}
          
          # ã€é‡è¦ã€‘æŒ‡å®šéƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
          # Action ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªåˆ†æ”¯
          publish_branch: gh-pages
          
          # Hexo ç”Ÿæˆçš„é™æ€æ–‡ä»¶åœ¨ public ç›®å½•
          publish_dir: ./public
          
          # æäº¤ä½œè€…ä¿¡æ¯
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
